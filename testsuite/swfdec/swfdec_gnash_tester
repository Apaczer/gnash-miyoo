#!/bin/sh 

# Get this from environment if available
GPROCESSOR=${GPROCESSOR:=gprocessor}

if [ -z "$1" ]; then
	echo "Usage: `basename $0` <swffile>" >&2
	exit 1
fi

echo "Using gprocessor ${GPROCESSOR}"

in="$1"
out=`basename "${in}"`.trace-gnash
exp="${in}.trace"

${GPROCESSOR} -r10 -f10 -v "$in"  | grep TRACE | sed 's/.*TRACE: //' | fromdos > $out
if test "$?" != 0; then
	echo "gprocessor returned an error"
	exit 1
else
	diff -u3 "$exp" "$out"
	exit $?
fi
