
#include "SWFCtype.h"

#include <locale>
#include <boost/assign/list_of.hpp>
#include <map>
#include <boost/cstdint.hpp>

#include "log.h"

namespace gnash {

namespace {
    typedef std::map<boost::uint16_t, boost::uint16_t> CharMap;
    const CharMap& lowerMap();
    const CharMap& upperMap();
}

SWFCtype::char_type
SWFCtype::do_toupper(char_type c) const
{
    // a-z
    if (c >= 97 && c <= 122) return c - 32;
    if (c >= 224 && c <= 246) return c - 32;
    if (c >= 249 && c <= 254) return c - 32;
    if (c >= 946 && c <= 961) return c - 32;
    if (c >= 963 && c <= 971) return c - 32;
    if (c >= 1072 && c <= 1103) return c - 32;
    if (c >= 1104 && c <= 1119) return c - 80;
    if (c >= 1377 && c <= 1414) return c - 48;
    if (c >= 7936 && c <= 7943) return c + 8;
    if (c >= 7952 && c <= 7957) return c + 8;
    if (c >= 7968 && c <= 7975) return c + 8;
    if (c >= 7984 && c <= 7991) return c + 8;
    if (c >= 8000 && c <= 8005) return c + 8;
    if (c >= 8033 && c <= 8039) return c + 8;
    if (c >= 8064 && c <= 8071) return c + 8;
    if (c >= 8080 && c <= 8087) return c + 8;
    if (c >= 8560 && c <= 8569) return c - 16;
    if (c >= 9424 && c <= 9449) return c - 26;
    if (c >= 65345 && c <= 65370) return c - 32;

    if ((c & 1)) {
        if (c >= 257 && c <= 303) return c - 1;
        if (c >= 307 && c <= 311) return c - 1;
        if (c >= 331 && c <= 375) return c - 1;
        if (c >= 387 && c <= 389) return c - 1;
        if (c >= 479 && c <= 495) return c - 1;
        if (c >= 505 && c <= 543) return c - 1;
        if (c >= 547 && c <= 563) return c - 1;
        if (c >= 987 && c <= 1007) return c - 1;
        if (c >= 1121 && c <= 1153) return c - 1;
        if (c >= 1165 && c <= 1215) return c - 1;
        if (c >= 1233 && c <= 1269) return c - 1;
        if (c >= 7681 && c <= 7829) return c - 1;
        if (c >= 7841 && c <= 7929) return c - 1;
    }
    else if (!(c & 1)) {
        if (c >= 314 && c <= 328) return c - 1;
        if (c >= 378 && c <= 382) return c - 1;
        if (c >= 462 && c <= 476) return c - 1;
    }

    // Search the remaining map.
    const CharMap& m = upperMap();
    const CharMap::const_iterator it = m.find(c);
    if (it == m.end()) return c;
    return it->second;
}

const SWFCtype::char_type*
SWFCtype::do_toupper(char_type* low, const char_type* high) const
{
    char_type* pos = low;
    while (pos != high) {
        *pos = do_toupper(*pos);
        ++pos;
    }
    return low;
}

SWFCtype::char_type
SWFCtype::do_tolower(char_type c) const
{
    if (c >= 65 && c <= 90) return c + 32;
    if (c >= 192 && c <= 214) return c + 32;
    if (c >= 216 && c <= 222) return c + 32;
    if (c >= 1040 && c <= 1071) return c + 32;
    if (c >= 9398 && c <= 9423) return c + 26;

    if (c >= 65313 && c <= 65338) return c + 32;
    
    if ((c & 1)) {
    }

    if (!(c & 1)) {
        if (c >= 329 && c <= 374) return c + 1;
        if (c >= 504 && c <= 542) return c + 1;
        if (c >= 546 && c <= 562) return c + 1;
        if (c >= 256 && c <= 302) return c + 1;
    }

    const CharMap& m = lowerMap();
    const CharMap::const_iterator it = m.find(c);
    if (it == m.end()) return c;
    return it->second;
}

const SWFCtype::char_type*
SWFCtype::do_tolower(char_type* low, const char_type* high) const
{
    char_type* pos = low;
    while (pos != high) {
        *pos = do_tolower(*pos);
        ++pos;
    }
    return low;
}

namespace {

const CharMap&
upperMap()
{
    static const CharMap upper = boost::assign::map_list_of
        (181, 924)
        (248, 216)
        (255, 376)
        (305, 73)
        (383, 83)
        (392, 391)
        (396, 395)
        (402, 401)
        (405, 502)
        (409, 408)
        (417, 416)
        (419, 418)
        (421, 420)
        (424, 423)
        (429, 428)
        (432, 431)
        (436, 435)
        (438, 437)
        (441, 440)
        (445, 444)
        (447, 503)
        (453, 452)
        (454, 452)
        (456, 455)
        (457, 455)
        (459, 458)
        (460, 458)
        (477, 398)
        (498, 497)
        (499, 497)
        (501, 500)
        (595, 385)
        (596, 390)
        (598, 393)
        (599, 394)
        (601, 399)
        (603, 400)
        (608, 403)
        (611, 404)
        (616, 407)
        (617, 406)
        (623, 412)
        (626, 413)
        (629, 415)
        (640, 422)
        (643, 425)
        (648, 430)
        (650, 433)
        (651, 434)
        (658, 439)
        (837, 921)
        (940, 902)
        (941, 904)
        (942, 905)
        (943, 906)
        (945, 913)
        (962, 931)
        (972, 908)
        (973, 910)
        (974, 911)
        (976, 914)
        (977, 920)
        (981, 934)
        (982, 928)
        (1008, 922)
        (1009, 929)
        (1010, 931)
        (1013, 917)
        (1218, 1217)
        (1220, 1219)
        (1224, 1223)
        (1228, 1227)
        (1273, 1272)
        (7835, 7776)
        (8017, 8025)
        (8019, 8027)
        (8021, 8029)
        (8023, 8031)
        (8032, 8040)
        (8048, 8122)
        (8049, 8123)
        (8050, 8136)
        (8051, 8137)
        (8052, 8138)
        (8053, 8139)
        (8054, 8154)
        (8055, 8155)
        (8056, 8184)
        (8057, 8185)
        (8058, 8170)
        (8059, 8171)
        (8060, 8186)
        (8061, 8187)
        (8096, 8104)
        (8097, 8105)
        (8098, 8106)
        (8099, 8107)
        (8100, 8108)
        (8101, 8109)
        (8102, 8110)
        (8103, 8111)
        (8112, 8120)
        (8113, 8121)
        (8115, 8124)
        (8126, 921)
        (8131, 8140)
        (8144, 8152)
        (8145, 8153)
        (8160, 8168)
        (8161, 8169)
        (8165, 8172)
        (8179, 8188)

        (8560, 8544)
        (8561, 8545)
        (8562, 8546)
        (8563, 8547)
        (8564, 8548)
        (8565, 8549)
        (8566, 8550)
        (8567, 8551)
        (8568, 8552)
        (8569, 8553)

        (8570, 8554)
        (8571, 8555)
        (8572, 8556)
        (8573, 8557)
        (8574, 8558)
        (8575, 8559);

    return upper;
}

const CharMap&
lowerMap()
{
    static const CharMap lower = boost::assign::map_list_of
        (304, 105)
        (306, 307)
        (308, 309)
        (310, 311)
        (313, 314)
        (315, 316)
        (317, 318)
        (319, 320)
        (321, 322)
        (323, 324)
        (325, 326)
        (327, 328)
        (376, 255)
        (377, 378)
        (379, 380)
        (381, 382)
        (385, 595)
        (386, 387)
        (388, 389)
        (390, 596)
        (391, 392)
        (393, 598)
        (394, 599)
        (395, 396)
        (398, 477)
        (399, 601)
        (400, 603)
        (401, 402)
        (403, 608)
        (404, 611)
        (406, 617)
        (407, 616)
        (408, 409)
        (412, 623)
        (413, 626)
        (415, 629)
        (416, 417)
        (418, 419)
        (420, 421)
        (422, 640)
        (423, 424)
        (425, 643)
        (428, 429)
        (430, 648)
        (431, 432)
        (433, 650)
        (434, 651)
        (435, 436)
        (437, 438)
        (439, 658)
        (440, 441)
        (444, 445)
        (452, 454)
        (453, 454)
        (455, 457)
        (456, 457)
        (458, 460)
        (459, 460)
        (461, 462)
        (463, 464)
        (465, 466)
        (467, 468)
        (469, 470)
        (471, 472)
        (473, 474)
        (475, 476)
        (478, 479)
        (480, 481)
        (482, 483)
        (484, 485)
        (486, 487)
        (488, 489)
        (490, 491)
        (492, 493)
        (494, 495)
        (497, 499)
        (498, 499)
        (500, 501)
        (502, 405)
        (503, 447)
        (902, 940)
        (904, 941)
        (905, 942)
        (906, 943)
        (908, 972)
        (910, 973)
        (911, 974)
        (913, 945)
        (914, 946)
        (915, 947)
        (916, 948)
        (917, 949)
        (918, 950)
        (919, 951)
        (920, 952)
        (921, 953)
        (922, 954)
        (923, 955)
        (924, 956)
        (925, 957)
        (926, 958)
        (927, 959)
        (928, 960)
        (929, 961)
        (931, 963)
        (932, 964)
        (933, 965)
        (934, 966)
        (935, 967)
        (936, 968)
        (937, 969)
        (938, 970)
        (939, 971)
        (986, 987)
        (988, 989)
        (990, 991)
        (992, 993)
        (994, 995)
        (996, 997)
        (998, 999)
        (1000, 1001)
        (1002, 1003)
        (1004, 1005)
        (1006, 1007)
        (1012, 952)
        (1024, 1104)
        (1025, 1105)
        (1026, 1106)
        (1027, 1107)
        (1028, 1108)
        (1029, 1109)
        (1030, 1110)
        (1031, 1111)
        (1032, 1112)
        (1033, 1113)
        (1034, 1114)
        (1035, 1115)
        (1036, 1116)
        (1037, 1117)
        (1038, 1118)
        (1039, 1119)
        (1120, 1121)
        (1122, 1123)
        (1124, 1125)
        (1126, 1127)
        (1128, 1129)
        (1130, 1131)
        (1132, 1133)
        (1134, 1135)
        (1136, 1137)
        (1138, 1139)
        (1140, 1141)
        (1142, 1143)
        (1144, 1145)
        (1146, 1147)
        (1148, 1149)
        (1150, 1151)
        (1152, 1153)
        (1164, 1165)
        (1166, 1167)
        (1168, 1169)
        (1170, 1171)
        (1172, 1173)
        (1174, 1175)
        (1176, 1177)
        (1178, 1179)
        (1180, 1181)
        (1182, 1183)
        (1184, 1185)
        (1186, 1187)
        (1188, 1189)
        (1190, 1191)
        (1192, 1193)
        (1194, 1195)
        (1196, 1197)
        (1198, 1199)
        (1200, 1201)
        (1202, 1203)
        (1204, 1205)
        (1206, 1207)
        (1208, 1209)
        (1210, 1211)
        (1212, 1213)
        (1214, 1215)
        (1217, 1218)
        (1219, 1220)
        (1223, 1224)
        (1227, 1228)
        (1232, 1233)
        (1234, 1235)
        (1236, 1237)
        (1238, 1239)
        (1240, 1241)
        (1242, 1243)
        (1244, 1245)
        (1246, 1247)
        (1248, 1249)
        (1250, 1251)
        (1252, 1253)
        (1254, 1255)
        (1256, 1257)
        (1258, 1259)
        (1260, 1261)
        (1262, 1263)
        (1264, 1265)
        (1266, 1267)
        (1268, 1269)
        (1272, 1273)
        (1329, 1377)
        (1330, 1378)
        (1331, 1379)
        (1332, 1380)
        (1333, 1381)
        (1334, 1382)
        (1335, 1383)
        (1336, 1384)
        (1337, 1385)
        (1338, 1386)
        (1339, 1387)
        (1340, 1388)
        (1341, 1389)
        (1342, 1390)
        (1343, 1391)
        (1344, 1392)
        (1345, 1393)
        (1346, 1394)
        (1347, 1395)
        (1348, 1396)
        (1349, 1397)
        (1350, 1398)
        (1351, 1399)
        (1352, 1400)
        (1353, 1401)
        (1354, 1402)
        (1355, 1403)
        (1356, 1404)
        (1357, 1405)
        (1358, 1406)
        (1359, 1407)
        (1360, 1408)
        (1361, 1409)
        (1362, 1410)
        (1363, 1411)
        (1364, 1412)
        (1365, 1413)
        (1366, 1414)
        (4256, 4304)
        (4257, 4305)
        (4258, 4306)
        (4259, 4307)
        (4260, 4308)
        (4261, 4309)
        (4262, 4310)
        (4263, 4311)
        (4264, 4312)
        (4265, 4313)
        (4266, 4314)
        (4267, 4315)
        (4268, 4316)
        (4269, 4317)
        (4270, 4318)
        (4271, 4319)
        (4272, 4320)
        (4273, 4321)
        (4274, 4322)
        (4275, 4323)
        (4276, 4324)
        (4277, 4325)
        (4278, 4326)
        (4279, 4327)
        (4280, 4328)
        (4281, 4329)
        (4282, 4330)
        (4283, 4331)
        (4284, 4332)
        (4285, 4333)
        (4286, 4334)
        (4287, 4335)
        (4288, 4336)
        (4289, 4337)
        (4290, 4338)
        (4291, 4339)
        (4292, 4340)
        (4293, 4341)
        (7680, 7681)
        (7682, 7683)
        (7684, 7685)
        (7686, 7687)
        (7688, 7689)
        (7690, 7691)
        (7692, 7693)
        (7694, 7695)
        (7696, 7697)
        (7698, 7699)
        (7700, 7701)
        (7702, 7703)
        (7704, 7705)
        (7706, 7707)
        (7708, 7709)
        (7710, 7711)
        (7712, 7713)
        (7714, 7715)
        (7716, 7717)
        (7718, 7719)
        (7720, 7721)
        (7722, 7723)
        (7724, 7725)
        (7726, 7727)
        (7728, 7729)
        (7730, 7731)
        (7732, 7733)
        (7734, 7735)
        (7736, 7737)
        (7738, 7739)
        (7740, 7741)
        (7742, 7743)
        (7744, 7745)
        (7746, 7747)
        (7748, 7749)
        (7750, 7751)
        (7752, 7753)
        (7754, 7755)
        (7756, 7757)
        (7758, 7759)
        (7760, 7761)
        (7762, 7763)
        (7764, 7765)
        (7766, 7767)
        (7768, 7769)
        (7770, 7771)
        (7772, 7773)
        (7774, 7775)
        (7776, 7777)
        (7778, 7779)
        (7780, 7781)
        (7782, 7783)
        (7784, 7785)
        (7786, 7787)
        (7788, 7789)
        (7790, 7791)
        (7792, 7793)
        (7794, 7795)
        (7796, 7797)
        (7798, 7799)
        (7800, 7801)
        (7802, 7803)
        (7804, 7805)
        (7806, 7807)
        (7808, 7809)
        (7810, 7811)
        (7812, 7813)
        (7814, 7815)
        (7816, 7817)
        (7818, 7819)
        (7820, 7821)
        (7822, 7823)
        (7824, 7825)
        (7826, 7827)
        (7828, 7829)
        (7840, 7841)
        (7842, 7843)
        (7844, 7845)
        (7846, 7847)
        (7848, 7849)
        (7850, 7851)
        (7852, 7853)
        (7854, 7855)
        (7856, 7857)
        (7858, 7859)
        (7860, 7861)
        (7862, 7863)
        (7864, 7865)
        (7866, 7867)
        (7868, 7869)
        (7870, 7871)
        (7872, 7873)
        (7874, 7875)
        (7876, 7877)
        (7878, 7879)
        (7880, 7881)
        (7882, 7883)
        (7884, 7885)
        (7886, 7887)
        (7888, 7889)
        (7890, 7891)
        (7892, 7893)
        (7894, 7895)
        (7896, 7897)
        (7898, 7899)
        (7900, 7901)
        (7902, 7903)
        (7904, 7905)
        (7906, 7907)
        (7908, 7909)
        (7910, 7911)
        (7912, 7913)
        (7914, 7915)
        (7916, 7917)
        (7918, 7919)
        (7920, 7921)
        (7922, 7923)
        (7924, 7925)
        (7926, 7927)
        (7928, 7929)
        (7944, 7936)
        (7945, 7937)
        (7946, 7938)
        (7947, 7939)
        (7948, 7940)
        (7949, 7941)
        (7950, 7942)
        (7951, 7943)
        (7960, 7952)
        (7961, 7953)
        (7962, 7954)
        (7963, 7955)
        (7964, 7956)
        (7965, 7957)
        (7976, 7968)
        (7977, 7969)
        (7978, 7970)
        (7979, 7971)
        (7980, 7972)
        (7981, 7973)
        (7982, 7974)
        (7983, 7975)
        (7992, 7984)
        (7993, 7985)
        (7994, 7986)
        (7995, 7987)
        (7996, 7988)
        (7997, 7989)
        (7998, 7990)
        (7999, 7991)
        (8008, 8000)
        (8009, 8001)
        (8010, 8002)
        (8011, 8003)
        (8012, 8004)
        (8013, 8005)
        (8025, 8017)
        (8027, 8019)
        (8029, 8021)
        (8031, 8023)
        (8040, 8032)
        (8041, 8033)
        (8042, 8034)
        (8043, 8035)
        (8044, 8036)
        (8045, 8037)
        (8046, 8038)
        (8047, 8039)
        (8072, 8064)
        (8073, 8065)
        (8074, 8066)
        (8075, 8067)
        (8076, 8068)
        (8077, 8069)
        (8078, 8070)
        (8079, 8071)
        (8088, 8080)
        (8089, 8081)
        (8090, 8082)
        (8091, 8083)
        (8092, 8084)
        (8093, 8085)
        (8094, 8086)
        (8095, 8087)
        (8104, 8096)
        (8105, 8097)
        (8106, 8098)
        (8107, 8099)
        (8108, 8100)
        (8109, 8101)
        (8110, 8102)
        (8111, 8103)
        (8120, 8112)
        (8121, 8113)
        (8122, 8048)
        (8123, 8049)
        (8124, 8115)
        (8136, 8050)
        (8137, 8051)
        (8138, 8052)
        (8139, 8053)
        (8140, 8131)
        (8152, 8144)
        (8153, 8145)
        (8154, 8054)
        (8155, 8055)
        (8168, 8160)
        (8169, 8161)
        (8170, 8058)
        (8171, 8059)
        (8172, 8165)
        (8184, 8056)
        (8185, 8057)
        (8186, 8060)
        (8187, 8061)
        (8188, 8179)
        (8486, 969)
        (8490, 107)
        (8491, 229)
        (8544, 8560)
        (8545, 8561)
        (8546, 8562)
        (8547, 8563)
        (8548, 8564)
        (8549, 8565)
        (8550, 8566)
        (8551, 8567)
        (8552, 8568)
        (8553, 8569)
        (8554, 8570)
        (8555, 8571)
        (8556, 8572)
        (8557, 8573)
        (8558, 8574)
        (8559, 8575);

    return lower;
}

} // unnamed namespace
} // namespace gnash
